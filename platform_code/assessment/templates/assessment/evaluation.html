{% extends 'base-evaluation.html' %}
{% load static %}
{% load add_attr %}
{% load home_tags %}
{% load i18n %}

{% block content %}

<div class="breadcrumbs">
    <a href="{% url 'home:user-profile' %}">{% trans 'Dashboard' %}</a>
    <span> ></span>
    <a href="{% url 'assessment:orga-summary' evaluation.organisation.id %}">{% trans 'Organisation' %}</a>
    <span> ></span>
    <a href="#" class="active-breadcrumb">{% trans 'Evaluation' %}</a>
</div>

{% if evaluation.is_upgradable %}
    <div>
        {% include "assessment/upgrade-banner.html" %}
    </div>
{% endif %}

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li {% if message.tags %} class=" alert alert-{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<div class="head-page">
    {% if organisation|get_role:user == "admin" %}
    <ul id='listTitle'>
        <li class="flex">
            <h1 class="h1-section" id="evaluationName" >{{ evaluation.name }}
            <button id="hiddenButton" class="btn btn-primary small-btn hidden-div"
                    data-toggle="modal" data-target="#modal-edit{{evaluation.id}}">
                <i class="fa fa-edit"></i>
            </button>
            </h1>
        </li>
    </ul>
    {% else %}
        <h1 class="h1-section">{{ evaluation.name }}</h1>
    {% endif %}

    <div class="modal" id="modal-edit{{evaluation.id}}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          {% include "assessment/edit-evaluation.html" %}
        </div>
      </div>
    </div>
    <div class="progress" title="{% blocktrans with progression=evaluation.calculate_progression %}{{ progression }}% done{% endblocktrans %}"
          style="width: 50%; margin: auto;">
      <div class="progress-bar " role="progressbar" aria-valuenow="{{evaluation.calculate_progression}}"
           style="width:{{evaluation.calculate_progression}}%; background-color: #28a745;"
           title="{% blocktrans with progression=evaluation.calculate_progression %}{{ progression }}% done{% endblocktrans %}"
           aria-valuemin="0" aria-valuemax="100" >
          {% if evaluation.calculate_progression != 0 %}
                <p class="progress-bar-text" >{{evaluation.calculate_progression}}%</p>
          {% endif %}
      </div>
        {% if evaluation.calculate_progression == 0 %}
                <p class="progress-bar-text" >{{evaluation.calculate_progression}}%</p>
          {% endif %}
    </div>
    <p class="center" style="margin-bottom: 0px;">{% trans "Creation date:" %} {{evaluation.created_at|format_date_calendar}}</p>
    <p class="center" style="margin-bottom: 30px;">{% trans "Version" %} {{evaluation.assessment.version}}</p>
    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
</div>
<main class="main-area">
    <div class="centered">
        <section class="cards-section">
            {% for section in section_list %}
                {% include "assessment/base-card-section.html" %}
            {% endfor %}
        </section>
    </div>
</main>
<div id="validation evaluation" >
    {% if evaluation.is_finished %}
        <div>
        <form action="{% url 'assessment:results' organisation.id evaluation.slug evaluation.id %}">
            <input type="submit" value="{% trans 'Validate and see the results' %}"
                   class="btn btn-primary float-right bottom-page-button" />
        </form>
        </div>
    {% else %}
    <form action="{% url 'assessment:results' organisation.id evaluation.slug evaluation.id %}">
        <input type="submit" value="{% trans 'Validate and see the results' %}" disabled="True"
               alt="{% trans 'Please you have to finish the evaluation before it can be validated' %}"
               title="{% trans 'Please you have to finish the evaluation before it can be validated' %}"
               class="btn btn-primary float-right bottom-page-button"/>
    </form>
    {% endif %}
</div>
<form action="{% url 'assessment:orga-summary' organisation.id %}">
    <input type="submit" value="{% trans 'Back to the organisation' %}" class="btn btn-primary float-left bottom-page-button"/>
</form>

<script>
// This script is used in the title of the evaluation page to allow the admin user to edit his evaluation name (display a button which open a popin)
$(document).ready(function(){
  $("h1").mouseover(function(){
    $("#hiddenButton").removeClass("hidden-div");
  });
  $("h1").mouseout(function(){
    $('#hiddenButton').addClass("hidden-div");
  });
});

</script>
{% endblock %}
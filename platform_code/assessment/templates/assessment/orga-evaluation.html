{% load static %}
{% load add_attr %}
{% load home_tags %}
{% load i18n %}

<h3 class="title-column">{% trans "Organisation's evaluations" %} </h3>


    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col" class="col-array">{% trans "Evaluation's name" %}</th>
          <th scope="col" class="col-array">{% trans "Version" %}</th>
          <th scope="col" class="col-array">{% trans "Creation date" %}</th>
          <th scope="col" class="col-array" >{% trans "Validation date" %}</th>
          <th scope="col" class="col-array">{% trans "Evaluation status" %}</th>
          <th scope="col" class="col-array">{% trans "Progression" %}</th>
          <th scope="col" class="col-array">{% trans "Score" %}</th>
          <th scope="col" class="col-array">{% trans "Action" %}</th>
          <th scope="col" class="col-array" style="display:none"></th>
        </tr>
      </thead>
      <tbody>
        {% for evaluation in evaluation_list %}
            <div  >
            <tr class="row-array" >

              <td class="case-array" >{{evaluation.name}}</td>
              <td class="case-array" >V{{evaluation.assessment.version}}</td>
              <td class="case-array">{{evaluation.created_at|format_date_calendar}}</td>

              {% if evaluation.is_finished %}
                <td class="case-array">{{evaluation.finished_at|format_date_calendar}}</td>
              {% else %}
                <td class="case-array">{% trans "Not validated yet" %}</td>
              {% endif %}

              {% if evaluation.is_finished %}
                <td class="case-array">{% trans "Validated" %}</td>
              {% else %}
                <td class="case-array">{% trans "In progress" %}</td>
              {% endif %}

              <td class="case-array">{{evaluation.calculate_progression}} %</td>

              {% if evaluation.is_finished %}
                <td class="case-array">{{evaluation.score}}</td>
              {% else %}
                <td class="case-array">-</td>
              {% endif %}
              <!-- If the evaluation is upgradable, which means a new assessment version exists-->
              {% if evaluation.is_upgradable %}
                <!-- If the evaluation is finished && upgradable -->
                {% if evaluation.is_finished %}
                  <td class="case-array">
                    <a class="btn btn-results medium-button" name="resultat-no-modif"
                       href="{% url 'assessment:results' organisation.id evaluation.slug evaluation.id %}"
                      >{% trans "Results" %}</a>
                    <!-- If the user is an admin of the organisation so he has the right to upgrade && evaluation finished && upgradable  -->
                    {% if organisation|get_role:user == "admin" %}
                      <a href="#" data-toggle="modal" data-target="#modal-upgrade-eval{{evaluation.id}}"
                         class="btn btn-primary medium-button margin-10"
                          >{% trans "Upgrade" %}</a>
                    <!-- If the user is not an admin of the organisation, he can not upgrade the evaluation   -->
                    {% else %}
                      <button class="btn btn-primary medium-button margin-10" disabled
                              title="{% trans 'You do not have the right to do this action' %}">{% trans "Upgrade" %}
                      </button>
                    <!-- endif role user -->
                    {% endif %}
                  </td>
                <!-- Else the evaluation is not finished ( && upgradable )-->
                {% else %}
                  <td class="case-array">
                    <a class="btn btn-modify medium-button" href="{{ evaluation.get_absolute_url}}">{% trans "Modify" %}</a>
                    <!-- If the user is an organisation admin -->
                    {% if organisation|get_role:user == "admin" %}
                      <a href="#" data-toggle="modal" data-target="#modal-upgrade-eval{{evaluation.id}}"
                         class="btn btn-primary medium-button margin-10"
                          >{% trans "Upgrade" %}</a>
                    <!--Else the user is not an organisation admin, ie simple user, so he cannot upgrade the evaluation  -->
                    {% else %}
                      <button class="btn btn-primary medium-button margin-10" disabled
                              title="{% trans 'You do not have the right to do this action' %}">{% trans "Upgrade" %}
                      </button>
                    <!-- Endif role user -->
                    {% endif %}
                  </td>
                <!-- Endif evaluation is finished -->
                {% endif %}
                <!-- Modal to upgrade-->
              <div class="modal" id="modal-upgrade-eval{{evaluation.id}}" aria-hidden="true"
                   data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog ">
                  <div class="modal-content">
                  {% include "assessment/upgrade-modal.html" %}
                  </div>
                </div>
              </div>
              <!-- Else the evaluation is not upgradable -->
              {% else %}
              {% if evaluation.is_finished %}
                  <td class="case-array">
                    <a class="btn btn-results medium-button"
                       name="resultat-no-modif" href="{% url 'assessment:results' organisation.id evaluation.slug evaluation.id %}"
                    >{% trans "Results" %}</a></td>
                {% else %}
                  <td class="case-array"><a class="btn btn-modify medium-button" href="{{ evaluation.get_absolute_url}}"
                  >{% trans "Modify" %}</a></td>
                {% endif %}
              <!-- Endif the evaluation is upgradable and end of the case -->
              {% endif %}

              <td class="div-trash" id="div-trash{{evaluation.id}}" style="border-top:0px; background-color: white;" >
                  {% if organisation|get_role:user == "admin" %}
                    <button class="btn btn-danger" data-toggle="modal" data-target="#modal-delete{{evaluation.id}}"><span class="fa fa-trash"></span></button>
                    <!-- The Modal delete evaluation -->
                    <!-- The modal is inside the for loop because we need to catch the evaluation id -->
                    <!-- It calls the DeleteEvaluation view -->
                      <div class="modal" id="modal-delete{{evaluation.id}}" aria-hidden="true">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            {% include "assessment/deletion-evaluation.html" %}
                          </div>
                        </div>
                      </div>
                  {% endif %}

              </td>
            </tr>
            </div>
           {% endfor %}
      </tbody>
    </table>






{% load static %}
{% load add_attr %}
{% load home_tags %}
{% load i18n %}

<h3 class="title-column">{% trans "Organisation's evaluations" %} </h3>


    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col" class="col-array">{% trans "Evaluation's name" %}</th>
          <th scope="col" class="col-array">{% trans "Version" %}</th>
          <th scope="col" class="col-array">{% trans "Creation date" %}</th>
          <th scope="col" class="col-array" >{% trans "Validation date" %}</th>
          <th scope="col" class="col-array">{% trans "Evaluation status" %}</th>
          <th scope="col" class="col-array">{% trans "Progression" %}</th>
          <th scope="col" class="col-array">{% trans "Score" %}</th>
          <th scope="col" class="col-array">{% trans "Action" %}</th>
          <th scope="col" class="col-array" class="display-none"></th>
        </tr>
      </thead>
      <tbody>
        {% for evaluation in evaluation_list %}
            <div  >
            <tr class="row-array" >

              <td class="case-array" >{{evaluation.name}}</td>
              <td class="case-array" >V{{evaluation.assessment.version}}</td>
              <td class="case-array">{{evaluation.created_at|format_date_calendar}}</td>

              {% if evaluation.is_finished %}
                <td class="case-array">{{evaluation.finished_at|format_date_calendar}}</td>
              {% else %}
                <td class="case-array">{% trans "Not validated yet" %}</td>
              {% endif %}

              {% if evaluation.is_finished %}
                <td class="case-array">{% trans "Validated" %}</td>
              {% else %}
                <td class="case-array">{% trans "In progress" %}</td>
              {% endif %}

              <td class="case-array">{{evaluation.calculate_progression}} %</td>

              {% if evaluation.is_finished %}
                <td class="case-array">{{evaluation_score_dic|get_item:evaluation.id}}</td>
              {% else %}
                <td class="case-array">-</td>
              {% endif %}
              <td class="case-array">
              <!-- If the evaluation is upgradable, which means a new assessment version exists-->
              {% if evaluation.is_upgradable %}
                  {% if organisation|get_role:user == "admin" or organisation|get_role:user == "editor" %}
                      <a href="#" data-toggle="modal" data-target="#modal-upgrade-eval{{evaluation.id}}"
                         class="btn btn-primary medium-button margin-10"
                          >{% trans "Upgrade" %}</a>
                    <!-- If the user is not an admin of the organisation, he can not upgrade the evaluation   -->
                    {% else %}
                      <button class="btn btn-primary medium-button margin-10" disabled
                              title="{% trans 'You do not have the right to do this action' %}">{% trans "Upgrade" %}
                      </button>
                    <!-- endif role user -->
                    {% endif %}
              {% endif %}

                <!-- If the evaluation is finished  -->
              {% if evaluation.is_finished %}
                  <a class="btn btn-results medium-button margin-10" name="resultat-no-modif"
                       href="{% url 'assessment:results' organisation.id evaluation.slug evaluation.id %}"
                      >{% trans "Results" %}
                  </a>
                  {% if organisation|get_role:user == "admin" or organisation|get_role:user == "editor" %}
                      <a class="btn btn-modify medium-button margin-10" href="{{ evaluation.get_absolute_url}}">
                        {% trans "Modify" %}
                      </a>
                  {% else %}
                    <a class="btn btn-modify medium-button margin-10" href="{{ evaluation.get_absolute_url}}">{% trans "Browse" %}</a>
                  {% endif %}
              {% else %}
                  {% if organisation|get_role:user == "admin" or organisation|get_role:user == "editor" %}
                      <a class="btn btn-modify medium-button margin-10" href="{{ evaluation.get_absolute_url}}">
                        {% trans "Continue" %}
                      </a>
                  {% else %}
                    <a class="btn btn-modify medium-button margin-10" href="{{ evaluation.get_absolute_url}}">{% trans "Browse" %}</a>
                  {% endif %}
              {% endif %}

                <!-- Modal to upgrade-->
              <div class="modal" id="modal-upgrade-eval{{evaluation.id}}" aria-hidden="true"
                   data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog ">
                  <div class="modal-content">
                  {% include "assessment/upgrade-modal.html" %}
                  </div>
                </div>
              </div>
              </td>

              <td class="div-hidden-icons background-white" id="div-hidden-icons{{evaluation.id}}" >
                  {% if organisation|get_role:user == "admin" or organisation|get_role:user == "editor" %}
                    <button class="btn btn-danger" data-toggle="modal" data-target="#modal-delete{{evaluation.id}}"><span class="fa fa-trash"></span></button>
                    <!-- The Modal delete evaluation -->
                    <!-- The modal is inside the for loop because we need to catch the evaluation id -->
                    <!-- It calls the DeleteEvaluation view -->
                      <div class="modal" id="modal-delete{{evaluation.id}}" aria-hidden="true">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            {% include "assessment/deletion-evaluation.html" %}
                          </div>
                        </div>
                      </div>
                  {% endif %}

              </td>
            </tr>
            </div>
           {% endfor %}
      </tbody>
    </table>





